# Dev Tool 使用說明書

這是一個整合式的開發工具，提供 JSON 資料轉換與日誌分析功能，幫助開發者快速處理 JSON 資料與排查日誌問題。

---

## 目錄
- [第一部分：JSON 工具 (JsonTool)](#第一部分json-工具-jsontool)
  - [功能概述](#功能概述)
  - [使用步驟](#使用步驟)
  - [資料格式說明](#資料格式說明)
  - [轉換模式詳解](#轉換模式詳解)
  - [使用範例](#使用範例)
- [第二部分：日誌分析器 (LogAnalyzer)](#第二部分日誌分析器-loganalyzer)
  - [功能概述](#功能概述-1)
  - [使用步驟](#使用步驟-1)
  - [日誌格式要求](#日誌格式要求)
  - [檢視模式](#檢視模式)
  - [篩選與搜尋](#篩選與搜尋)
  - [使用範例](#使用範例-1)

---

## 第一部分：JSON 工具 (JsonTool)

### 功能概述

JSON 工具提供多種 JSON 資料轉換功能，協助開發者：
- 快速清理與格式化 JSON 資料
- 將真實資料轉換為測試資料
- 壓縮與美化 JSON 格式
- 支援檔案上傳與下載

### 使用步驟

#### 步驟 1：輸入 JSON 資料

有兩種方式輸入資料：

**方式 A：手動貼上**
1. 在左側「JSON 輸入」文字區域直接貼上您的 JSON 資料
2. 支援複製貼上快捷鍵（Ctrl+V / Cmd+V）

**方式 B：上傳檔案**
1. 點擊「上傳 JSON 檔案」按鈕
2. 選擇本機的 `.json` 或 `.txt` 檔案
3. 檔案內容會自動載入到輸入區

#### 步驟 2：選擇轉換模式

點擊對應的功能按鈕執行轉換：

| 按鈕名稱 | 功能說明 | 適用場景 |
|---------|---------|---------|
| **清理並格式化** | 移除特殊字符並美化 JSON | 處理從 Slack/Teams 等平台複製的 JSON |
| **數值清空** | 將所有數值轉為 `null` | 建立資料結構範本 |
| **智能轉換** | 轉換為測試用的假資料 | 產生測試資料集 |
| **壓縮** | 移除所有空白與換行 | 減少檔案大小、網路傳輸 |
| **格式化** | 美化 JSON 為易讀格式 | 檢視與除錯 |

#### 步驟 3：查看與使用結果

轉換完成後，右側「輸出」區域會顯示結果：
- **複製**：點擊「複製輸出」按鈕，將結果複製到剪貼簿
- **下載**：點擊「下載 JSON」按鈕，儲存為檔案（檔名格式：`transformed_原檔名.json`）
- **清除**：點擊「清除全部」按鈕，重置輸入與輸出區域

### 資料格式說明

#### 輸入格式

接受標準 JSON 格式，包括：
- **JSON 物件**：`{ "key": "value" }`
- **JSON 陣列**：`[ 1, 2, 3 ]`
- **巢狀結構**：任意深度的巢狀物件與陣列
- **特殊字符**：會在「清理並格式化」模式下自動處理

#### 輸出格式

根據選擇的轉換模式輸出：
- **格式化模式**：縮排 2 空格的美化 JSON
- **壓縮模式**：單行無空白的 JSON 字串
- **轉換模式**：處理後的 JSON 結構（格式化輸出）

### 轉換模式詳解

#### 1. 清理並格式化 (Clean & Format)

**功能**：移除 JSON 字串中的特殊字符並格式化

**處理內容**：
- 智能引號轉換：`"` `"` → `"`
- 全角符號正規化：`：` → `:`, `，` → `,`
- 零寬字符移除：零寬空格、零寬連接符等
- 控制字符清理：移除 ASCII 控制字符

**輸入範例**：
```json
{"name"："測試"，"value"：123}
```

**輸出範例**：
```json
{
  "name": "測試",
  "value": 123
}
```

#### 2. 數值清空 (Nullify Transform)

**功能**：保留 JSON 結構，將所有值轉換為 `null`

**適用場景**：
- 建立 API 請求/回應範本
- 產生資料庫 Schema 參考
- 記錄資料結構而不暴露內容

**輸入範例**：
```json
{
  "user": {
    "name": "Alice",
    "age": 30,
    "active": true
  },
  "items": [1, 2, 3]
}
```

**輸出範例**：
```json
{
  "user": {
    "name": null,
    "age": null,
    "active": null
  },
  "items": [null, null, null]
}
```

#### 3. 智能轉換 (Smart Transform)

**功能**：將真實資料轉換為測試用的假資料

**轉換規則**：

| 原始資料類型 | 轉換結果 | 範例 |
|------------|---------|------|
| **字串 (String)** | 空字串 `""` | `"Alice"` → `""` |
| **日期字串** | 當前 ISO 時間或轉換後的日期 | `"2024-01-01"` → `"2024-01-01T00:00:00.000Z"` |
| **數字 (Number)** | 隨機 `0` 或 `-1` ~ `-100` | `123` → `0` 或 `-45` |
| **布林 (Boolean)** | `false` | `true` → `false` |
| **Null** | `null` | 保持不變 |
| **物件/陣列** | 遞迴處理每個屬性/元素 | 保留結構 |

**日期識別條件**：
- 符合 `YYYY-MM-DD` 格式
- 符合 `YYYY/MM/DD` 格式
- 包含 `T` 且以 `Z` 結尾或包含時區（ISO 8601）

**輸入範例**：
```json
{
  "username": "john_doe",
  "email": "john@example.com",
  "age": 28,
  "isActive": true,
  "createdAt": "2024-02-11T10:30:00Z",
  "balance": 1500.50
}
```

**輸出範例**：
```json
{
  "username": "",
  "email": "",
  "age": -67,
  "isActive": false,
  "createdAt": "2024-02-11T10:30:00.000Z",
  "balance": 0
}
```

#### 4. 壓縮 (Compact)

**功能**：移除所有空白字符，輸出單行 JSON

**適用場景**：
- 網路傳輸最小化
- API 請求內容壓縮
- 儲存空間優化

**輸入範例**：
```json
{
  "name": "Product",
  "price": 99.99,
  "tags": [
    "electronics",
    "sale"
  ]
}
```

**輸出範例**：
```json
{"name":"Product","price":99.99,"tags":["electronics","sale"]}
```

#### 5. 格式化 (Format)

**功能**：標準 JSON 美化，使用 2 空格縮排

**適用場景**：
- 檢視壓縮後的 JSON
- 除錯與程式碼審查
- 文件撰寫

**輸入範例**：
```json
{"name":"Test","value":123,"nested":{"key":"val"}}
```

**輸出範例**：
```json
{
  "name": "Test",
  "value": 123,
  "nested": {
    "key": "val"
  }
}
```

### 使用範例

#### 範例 1：處理從 Slack 複製的 JSON

**情境**：從 Slack 訊息中複製的 JSON 包含特殊引號無法解析

**步驟**：
1. 貼上包含特殊字符的 JSON：
   ```
   {"message"："測試訊息"，"code"：200}
   ```
2. 點擊「清理並格式化」
3. 獲得標準 JSON：
   ```json
   {
     "message": "測試訊息",
     "code": 200
   }
   ```

#### 範例 2：產生 API 測試資料

**情境**：需要根據正式環境資料產生測試資料

**步驟**：
1. 貼上正式資料：
   ```json
   {
     "orderId": "ORD-12345",
     "customer": "王小明",
     "amount": 2500,
     "createdAt": "2024-02-11T15:30:00Z"
   }
   ```
2. 點擊「智能轉換」
3. 獲得測試資料：
   ```json
   {
     "orderId": "",
     "customer": "",
     "amount": -89,
     "createdAt": "2024-02-11T15:30:00.000Z"
   }
   ```

#### 範例 3：建立資料結構範本

**情境**：記錄 API 回應結構而不暴露真實內容

**步驟**：
1. 貼上完整 API 回應
2. 點擊「數值清空」
3. 獲得結構範本（所有值為 `null`）
4. 點擊「下載 JSON」儲存為範本檔案

---

## 第二部分：日誌分析器 (LogAnalyzer)

### 功能概述

日誌分析器是一個專業的日誌分析工具，提供：
- 自動解析日誌檔案
- Request/Response 交易配對
- 多維度篩選與搜尋
- 成功/失敗統計分析
- JSON 內容格式化檢視

### 使用步驟

#### 步驟 1：匯入日誌資料

有兩種方式匯入日誌：

**方式 A：貼上日誌內容**
1. 在右側「日誌輸入」文字區域貼上日誌內容
2. 點擊「分析日誌」按鈕

**方式 B：上傳日誌檔案**
1. 點擊「上傳日誌檔案」按鈕
2. 選擇 `.log` 或 `.txt` 檔案
3. 系統會顯示上傳進度並自動分析

#### 步驟 2：查看統計資訊

分析完成後，頂部會顯示三個統計卡片：

| 統計項目 | 說明 | 顏色標示 |
|---------|------|---------|
| **錯誤** | Response Status 非 Success 的交易數 | 紅色 |
| **成功** | Response Status 為 Success 的交易數 | 綠色 |
| **總日誌數** | 所有日誌條目的總數 | 灰色 |

#### 步驟 3：選擇檢視模式

點擊分析結果區域上方的檢視模式切換按鈕：

- **原始列表**：顯示所有日誌條目，按時間排序
- **交易檢視 (Beta)**：自動配對 Request/Response，顯示交易詳情

#### 步驟 4：篩選與搜尋

使用多種篩選工具精確定位問題：

**狀態篩選**：
- 全部
- 錯誤（只顯示失敗交易）
- 成功（只顯示成功交易）

**標籤篩選**：
- 點擊標籤按鈕快速篩選特定類型的日誌

**文字搜尋**：
- 在搜尋框輸入關鍵字
- 支援搜尋日誌內容、識別碼、錯誤訊息等
- 與標籤篩選為 **OR** 關係（符合任一即顯示）

#### 步驟 5：查看詳細內容

**原始列表模式**：
- 點擊包含 JSON 的日誌條目可展開/收合 JSON 內容
- JSON 會自動格式化並語法高亮
- 可點擊「複製 JSON 內容」按鈕複製

**交易檢視模式**：
- 點擊交易卡片展開詳情
- 左側顯示 Request 內容
- 右側顯示 Response 內容
- 可分別複製 Request/Response 內容
- 顯示交易時長（毫秒）

### 日誌格式要求

#### 基本格式

每行日誌應包含以下資訊（順序可調整）：

```
時間戳記 日誌等級 訊息內容
```

#### 時間戳記格式

支援以下時間格式：
- `YYYY-MM-DD HH:mm:ss`
- `YYYY-MM-DD HH:mm:ss.SSS`
- `YYYY-MM-DDTHH:mm:ss.SSSZ` (ISO 8601)

**範例**：
- `2026-02-11 19:30:41`
- `2026-02-11 19:30:41.565`
- `2026-02-11T19:30:41.565Z`

#### 日誌等級

識別以下等級關鍵字（不區分大小寫）：
- `ERROR`
- `WARN`
- `INFO`
- `DEBUG`

#### 訊息內容

**Request 日誌**應包含：
- 關鍵字：`request` 或 `InputChainData`
- JSON 格式的請求資料
- 至少一個識別碼（ShopId, OrderCode, ShippingOrderCode 等）

**Response 日誌**應包含：
- 關鍵字：`response` 或 `OutputChainData`
- JSON 格式的回應資料
- Status 欄位（`"Status": "Success"` 或 `"Status": "Failure"`）

#### 日誌範例

**完整格式範例**：
```
2026-02-11 19:30:41.565 INFO 更新超取訂單出貨request{"ShopId":41571,"ShippingOrderCode":"06713246800","OrderDeliverType":"Family"}
2026-02-11 19:30:41.721 INFO response:{"ErrorId":"52986284-268f-4a21-8263-0311345247e2","Status":"Failure","Data":null,"ErrorMessage":"06713246800 => 訂單取能處於待出貨"}
```

**最簡格式範例**：
```
2026-02-11 19:30:35 更新超取訂單出貨request{"ShopId":41571,"ShippingOrderCode":"43966540"}
2026-02-11 19:30:36 response:{"Status":"Success","Data":"Success"}
```

### 檢視模式

#### 原始列表模式

**特點**：
- 顯示所有日誌條目
- 按時間倒序排列（最新在上）
- 每頁顯示 50 筆
- 支援分頁導覽

**日誌卡片顯示**：
- **左側**：日誌等級徽章（ERROR/WARN/INFO）
- **中間**：時間戳記
- **右側**：完整訊息內容
- **底部**：如有 JSON 顯示「展開 JSON」提示

**顏色標示**：
- 錯誤 (ERROR)：紅色背景
- 警告 (WARN)：黃色背景
- 資訊 (INFO)：藍色背景

#### 交易檢視模式 (Beta)

**特點**：
- 自動配對 Request/Response
- 顯示交易時長
- 狀態指示燈（綠色=成功，紅色=失敗）
- 雙欄並排顯示 Request 與 Response

**配對規則**：

1. **優先 Key 匹配**（精確配對）：
   - 提取 Request/Response 中的識別碼
   - 支援欄位：`ShopId`, `OrderCode`, `ShippingOrderCode`, `TSCode`, `TMCode`
   - 從 ErrorMessage 等文字內容中也會提取數字型識別碼（8-15位）

2. **時間序列配對**（備用配對）：
   - 當 Response 無識別碼時啟用
   - 配對時間最接近的未配對 Request
   - 限制時間差在 10 秒內

**交易卡片顯示**：
- **狀態指示燈**：綠色圓點（成功）/ 紅色圓點（失敗）
- **時間戳記**：Request 的時間
- **識別碼徽章**：顯示配對使用的 Key（如 `ShopId: 41571`）
- **時間標籤**：如為時間配對會標註 `[時間配對]`
- **交易時長**：Response 時間 - Request 時間（毫秒）
  - 綠色：< 1000ms（效能良好）
  - 黃色：≥ 1000ms（效能警告）

**展開詳情顯示**：
- **Request 欄位**（左側）：
  - 標題：REQUEST
  - JSON 格式化內容
  - 複製按鈕
- **Response 欄位**（右側）：
  - 標題：RESPONSE
  - JSON 格式化內容（錯誤時紅色顯示）
  - 複製按鈕

### 篩選與搜尋

#### 狀態篩選

點擊「全部」「錯誤」「成功」按鈕：

- **全部**：顯示所有交易（藍色背景表示已選）
- **錯誤**：只顯示 Status 非 Success 的交易（紅色背景表示已選）
- **成功**：只顯示 Status 為 Success 的交易（綠色背景表示已選）

**作用範圍**：
- 原始列表模式：根據 Response 的 Status 判斷
- 交易檢視模式：根據配對後的交易狀態

#### 標籤篩選

系統會自動從日誌中提取標籤（Tag）：

**標籤識別規則**：
1. `Key:` 模式（如 `InitialData:`, `response:`）
2. `Key{` 模式（如 `request{`）
3. 第一個詞（通用回退）

**使用方式**：
- 點擊「全部標籤」顯示所有日誌
- 點擊特定標籤只顯示該類型的日誌
- 藍色背景表示已選擇

**標籤範例**：
- `更新超取訂單出貨request`
- `SendSlackMessage API`
- `EtlFlowService constructor`
- `response`

#### 文字搜尋

在搜尋框輸入關鍵字：

**搜尋範圍**：
- 日誌訊息內容
- 識別碼
- 錯誤訊息
- Request/Response JSON 內容

**邏輯關係**：
- 搜尋 **OR** 標籤：符合搜尋關鍵字「或」符合標籤即顯示
- 與狀態篩選為 **AND** 關係

**搜尋範例**：
- 搜尋 `06713246800` → 顯示包含此訂單號的所有日誌
- 搜尋 `Failure` → 顯示包含失敗訊息的日誌
- 搜尋 `ShopId` → 顯示包含 ShopId 欄位的日誌

### 使用範例

#### 範例 1：快速定位失敗交易

**情境**：需要查看所有失敗的 API 呼叫

**步驟**：
1. 上傳或貼上日誌檔案
2. 點擊「交易檢視 (Beta)」切換到交易模式
3. 點擊「錯誤」按鈕篩選失敗交易
4. 查看統計卡片確認錯誤數量
5. 點擊紅色圓點的交易卡片查看詳情
6. 在 Response 欄位檢視錯誤訊息

#### 範例 2：追蹤特定訂單的處理流程

**情境**：客戶反映訂單 `06713246800` 出現問題

**步驟**：
1. 在搜尋框輸入 `06713246800`
2. 系統會顯示所有相關日誌
3. 切換到「交易檢視」查看 Request/Response 配對
4. 檢查 Response 的 Status 與 ErrorMessage
5. 記錄交易時長確認是否有效能問題

#### 範例 3：分析特定時段的日誌

**情境**：下午 7:30 系統出現大量錯誤

**步驟**：
1. 上傳完整日誌檔案
2. 在搜尋框輸入 `19:30`
3. 點擊「錯誤」按鈕篩選失敗交易
4. 查看統計資訊了解錯誤規模
5. 點擊標籤篩選特定 API 呼叫
6. 逐一檢查交易詳情找出根本原因

#### 範例 4：匯出特定交易的 JSON 內容

**情境**：需要將失敗的 Request 提供給開發團隊

**步驟**：
1. 篩選出失敗交易
2. 點擊展開交易詳情
3. 點擊 Request 區域右上角的「複製」按鈕
4. 貼到開發工具或文件中
5. 重複以上步驟複製 Response 內容

#### 範例 5：監控 API 效能

**情境**：檢查哪些 API 呼叫耗時較長

**步驟**：
1. 切換到「交易檢視」模式
2. 觀察交易卡片右側的時長標籤
3. 黃色標籤表示超過 1 秒的慢查詢
4. 點擊慢查詢展開詳情
5. 檢查 Request 參數是否有異常
6. 記錄慢查詢的識別碼進行優化

---

## 常見問題 (FAQ)

### JSON 工具

**Q: 為什麼「清理並格式化」無法解析我的 JSON？**  
A: 請確認：
- JSON 結構完整（括號配對）
- 沒有多餘的尾隨逗號
- 字串值有正確的引號包圍
- 如果仍失敗，請嘗試先在線上 JSON 驗證工具檢查語法

**Q: 智能轉換的數字為什麼是負數？**  
A: 智能轉換會隨機生成 0 或 -1 ~ -100 的負數，這是為了：
- 明顯區分測試資料與正式資料
- 避免與真實數據混淆
- 保持數字類型的有效性

**Q: 日期轉換為什麼會改變時區？**  
A: 智能轉換會將所有日期統一轉換為 ISO 8601 格式（UTC 時區），這是國際標準格式，確保跨時區一致性。

### 日誌分析器

**Q: 為什麼我的日誌無法配對成交易？**  
A: 請檢查：
- Request 日誌是否包含識別碼（ShopId, OrderCode 等）
- Response 是否在 Request 後 10 秒內出現
- 日誌是否包含 `request` / `response` 關鍵字
- JSON 格式是否正確

**Q: 時間配對是什麼意思？**  
A: 當 Response 中沒有可識別的 Key 時，系統會使用「時間配對」，將 Response 配對到時間最接近的 Request。這種配對標註 `[時間配對]` 以提醒可能不夠精確。

**Q: 錯誤統計為什麼與我預期的不同？**  
A: 統計基於 Response 的 `Status` 欄位：
- `"Status": "Success"` → 成功
- `"Status": "Failure"` 或其他值 → 錯誤
- 日誌等級 `ERROR` → 錯誤

**Q: 搜尋與標籤篩選有什麼不同？**  
A: 
- **搜尋**：全文搜尋，包括 JSON 內容
- **標籤**：依據日誌類型（如 API 名稱）快速篩選
- 兩者為 **OR** 關係，符合任一即顯示

**Q: 如何提高配對準確度？**  
A: 建議日誌格式包含：
- 清楚的 Request/Response 關鍵字
- 至少一個唯一識別碼（訂單號、交易號等）
- 結構化的 JSON 格式
- 準確的時間戳記

---

## 技術規格

### JSON 工具

- **支援的檔案格式**：`.json`, `.txt`
- **最大檔案大小**：受瀏覽器記憶體限制
- **輸出編碼**：UTF-8
- **縮排格式**：2 空格

### 日誌分析器

- **支援的檔案格式**：`.log`, `.txt`
- **每頁顯示數量**：50 筆
- **交易配對時間窗口**：10 秒
- **識別碼長度範圍**：8-15 位數字
- **支援的識別碼欄位**：
  - `ShopId`
  - `OrderCode`
  - `ShippingOrderCode`
  - `TSCode`
  - `TMCode`

---

## 版本資訊

**目前版本**：1.0.0  
**最後更新**：2026 年 2 月 13 日

### 更新日誌

- **v1.0.0** (2026-02-13)
  - 首次發布
  - JSON 工具：5 種轉換模式
  - 日誌分析器：交易配對功能（Beta）
  - 支援淺色/深色主題切換

---

## 回饋與支援

如有任何問題或建議，歡迎：
- 提交 Issue 到專案 GitHub Repository
- 聯繫開發團隊

---

**文件結束**
